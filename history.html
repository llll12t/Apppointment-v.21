<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Thai:wght@400;700&display=swap"
    rel="stylesheet" />
  <style>
    body {
      font-family: 'Noto Sans Thai', sans-serif;
    }

    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20' fill='none' stroke='%234A5568' stroke-width='1.5'%3E%3Cpath d='M7 10l5 5 5-5'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.75rem center;
      background-size: 1.25em 1.25em;
      padding-right: 2.5rem;
    }

    .spinner {
      width: 3rem;
      height: 3rem;
      border: .5rem solid #eee;
      border-top: .5rem solid #4f46e5;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .hidden {
      display: none;
    }
  </style>
</head>

<body class="bg-gradient-to-b from-purple-100 via-orange-100 to-white min-h-screen relative bg-fixed">

  <!-- Loading Overlay -->
  <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-50">
    <div class="spinner"></div>
  </div>

  <!-- Custom Confirm Overlay -->
  <div id="customAlertOverlay" class="fixed inset-0 invisible items-center justify-center bg-black bg-opacity-50 z-50">
    <div class="bg-white p-6 rounded shadow-lg text-center w-80">
      <p id="customAlertMessage" class="mb-6 text-gray-700 text-sm"></p>
      <div id="customAlertButtons" class="flex justify-center gap-4">
        <button id="customAlertCancel" class="bg-gray-300 text-gray-800 px-4 py-2 rounded">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button id="customAlertOk" class="bg-indigo-600 text-white px-4 py-2 rounded">‡∏ï‡∏Å‡∏•‡∏á</button>
      </div>
    </div>
  </div>

  <main class="max-w-lg mx-auto p-4">
    <h1 class="text-xl font-bold mb-4">‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì)</h1>

    <!-- ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á: ‡∏™‡∏≤‡∏Ç‡∏≤, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà -->
    <div class="grid grid-cols-2 md:grid-cols-3 gap-2 mb-4">
      <select id="branchFilter" class="bg-white p-2 border rounded-lg">
        <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>
      </select>
      <select id="statusFilter" class="bg-white p-2 border rounded-lg">
        <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
        <option value="‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</option>
        <option value="‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
        <option value="‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
        <option value="‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</option>
      </select>
      <select id="dateSort" class="bg-white p-2 border rounded-lg">
        <option value="latest">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
        <option value="oldest">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î</option>
      </select>
    </div>

    <!-- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• -->
    <table class="w-full bg-white rounded-lg shadow text-sm">
      <thead>
        <tr>
          <th class="bg-[#2F1A87] text-white p-2 text-left rounded-tl-lg">‡∏ä‡∏∑‡πà‡∏≠</th>
          <th class="bg-[#2F1A87] text-white p-2 text-left">‡∏™‡∏≤‡∏Ç‡∏≤</th>
          <th class="bg-[#2F1A87] text-white p-2 text-left">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
          <th class="bg-[#2F1A87] text-white p-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
          <th class="bg-[#2F1A87] text-white p-2 text-center rounded-tr-lg">‡∏î‡∏π</th>
        </tr>
      </thead>
      <tbody id="dataBody">
        <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
      </tbody>
    </table>

    <!-- Pagination Controls -->
    <div id="pagination" class="flex justify-center items-center space-x-1 mt-4 text-sm"></div>

    <!-- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤ User ID ‡∏Ç‡∏≠‡∏á LIFF -->
    <input type="hidden" id="useridlineFilter" />
  </main>

<!--   <script src="Config.js"></script> -->
  <script>
    const DETAILS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwRDs7takd9ozlconIGh3kVaBBzjMKP1Il_cOSVZ_RMkJNigputZPMFvA3GYtSi1QOCDA/exec';
    const LIFF_ID_HIS = '2007432636-g5YyoKjr';

    const rowsPerPage = 10;
    let currentData = [];
    let currentPage = 1;

    const showLoading = () => document.getElementById('loadingOverlay').classList.remove('hidden');
    const hideLoading = () => document.getElementById('loadingOverlay').classList.add('hidden');

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á dialog ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
    function confirmAction(message, action, id, branchId) {
      const overlay = document.getElementById('customAlertOverlay');
      const alertMessage = document.getElementById('customAlertMessage');
      const btnOk = document.getElementById('customAlertOk');
      const btnCancel = document.getElementById('customAlertCancel');

      alertMessage.textContent = message;
      overlay.classList.replace('invisible', 'flex');

      btnOk.textContent = '‡∏ï‡∏Å‡∏•‡∏á';
      btnCancel.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
      btnOk.style.display = btnCancel.style.display = 'inline-block';

      btnCancel.onclick = () => {
        overlay.classList.replace('flex', 'invisible');
      };

      btnOk.onclick = () => {
        btnOk.style.display = btnCancel.style.display = 'none';
        alertMessage.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‚Ä¶';
        showLoading();

        let url = `${DETAILS_SCRIPT_URL}?action=${action}&id=${encodeURIComponent(id)}`;
        if (branchId) {
          url += `&branchId=${encodeURIComponent(branchId)}`;
        }

        fetch(url, { method: 'POST' })
          .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status}`);
            return res.text();
          })
          .then(() => {
            alertMessage.textContent = '‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à';
            btnOk.textContent = '‡∏õ‡∏¥‡∏î';
            btnOk.style.display = 'inline-block';
            hideLoading();
            btnOk.onclick = () => {
              overlay.classList.replace('flex', 'invisible');
              loadData();
            };
          })
          .catch(err => {
            console.error(err);
            hideLoading();
            alertMessage.textContent = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
            btnOk.textContent = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
            btnCancel.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å';
            btnOk.style.display = btnCancel.style.display = 'inline-block';
            btnOk.onclick = () => confirmAction(message, action, id, branchId);
            btnCancel.onclick = () => overlay.classList.replace('flex', 'invisible');
          });
      };
    }

    // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏ó‡∏≥ LIFF init ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á profile
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        await liff.init({ liffId: LIFF_ID_HIS });
        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href });
          return;
        }
        const profile = await liff.getProfile();
        document.getElementById('useridlineFilter').value = profile.userId;

        // ‡∏ú‡∏π‡∏Å event ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏°‡∏ï‡∏±‡∏ß ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        ['branchFilter', 'statusFilter', 'dateSort'].forEach(id => {
          document.getElementById(id).addEventListener('change', loadData);
        });

        loadData();
      } catch (err) {
        console.error('LIFF Error:', err);
        // ‡∏ñ‡πâ‡∏≤ LIFF ‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡πÅ‡∏™‡∏î‡∏á alert ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏á‡πà‡∏≤‡∏¢
        alert('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î LIFF: ' + err.message);
      }
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å GAS ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° user, ‡∏™‡∏≤‡∏Ç‡∏≤, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞, ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤
    async function loadData() {
      const tbody = document.getElementById('dataBody');
      const paginationEl = document.getElementById('pagination');

      // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î" ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
      tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-gray-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>';
      paginationEl.innerHTML = '';

      try {
        const res = await fetch(`${DETAILS_SCRIPT_URL}?action=fetchBookings`);
        const allData = await res.json();
        const uid = document.getElementById('useridlineFilter').value;

        // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà user ‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á (userlineid)
        const ownData = allData.filter(d => d.userlineid === uid)
          .map(d => ({
            ...d,
            // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å "dd-mm-yyyy" ‡πÄ‡∏õ‡πá‡∏ô Date object
            parsedDate: new Date(d.date.split('-').reverse().join('-'))
          }));

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤ ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á user ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ
        populateBranchFilter(ownData);

        // ‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
        const sorted = ownData.sort((a, b) =>
          document.getElementById('dateSort').value === 'latest' ?
            b.parsedDate - a.parsedDate :
            a.parsedDate - b.parsedDate
        );

        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        const status = document.getElementById('statusFilter').value.toLowerCase();
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏≤‡∏Ç‡∏≤ (branchFilter)
        const selectedBranch = document.getElementById('branchFilter').value;

        currentData = sorted.filter(d =>
          (!status || d.status.toLowerCase() === status) &&
          (!selectedBranch || d.branchId === selectedBranch)
        );

        currentPage = 1;
        displayPage(currentPage);
      } catch (err) {
        console.error(err);
        alert('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
        tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-red-500">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</td></tr>';
      }
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏á user ‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ
    function populateBranchFilter(data) {
      const branchFilter = document.getElementById('branchFilter');
      const uniqueBranches = [...new Set(data.map(item => item.branchId || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'))].filter(b => b !== '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏').sort();
      const currentSelected = branchFilter.value;

      branchFilter.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤</option>';
      uniqueBranches.forEach(branch => {
        const option = document.createElement('option');
        option.value = branch;
        option.textContent = branch;
        branchFilter.appendChild(option);
      });
      // ‡∏´‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ‡∏ï‡πà‡∏≠
      if (uniqueBranches.includes(currentSelected)) {
        branchFilter.value = currentSelected;
      } else {
        branchFilter.value = '';
      }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
    function displayPage(page) {
      const tbody = document.getElementById('dataBody');
      tbody.innerHTML = '';

      if (currentData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4 text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
      } else {
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;
        const pageData = currentData.slice(start, end);

        pageData.forEach(item => {
          // ‡πÅ‡∏ñ‡∏ß‡∏´‡∏•‡∏±‡∏Å
          const row = document.createElement('tr');
          row.innerHTML = `
            <td class="p-2 border-b">${item.name}</td>
            <td class="p-2 border-b">${item.branchId}</td>
            <td class="p-2 border-b">${item.date}</td>
            <td class="p-2 border-b text-center">${item.status}</td>
            <td class="p-2 border-b text-center">
              <button class="toggleDetail bg-[#2F1A87] text-white px-2 py-1 rounded">‡∏î‡∏π</button>
            </td>
          `;
          tbody.appendChild(row);

          // ‡πÅ‡∏ñ‡∏ß‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πà‡∏≠‡∏ô)
          const detailRow = document.createElement('tr');
          detailRow.classList.add('hidden');
          detailRow.innerHTML = `
            <td colspan="5" class="bg-gray-50 p-4 text-sm">
              <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${item.name}</p>
              <p><strong>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</strong> ${item.phonenumber}</p>
              <p><strong>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£:</strong> ${item.service}</p>
              <p><strong>‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${item.price}</p>
              <p><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${item.date}</p>
              <p><strong>‡πÄ‡∏ß‡∏•‡∏≤:</strong> ${item.time}</p>
              <p><strong>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</strong> ${item.note || '-'}</p>
              <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> ${item.status}</p>
              <div class="mt-4 flex flex-wrap gap-2">
                <button class="actionBtn bg-yellow-500 text-white px-3 py-1 rounded" data-action="sendReminder" data-id="${item.idKey}" data-branch-id="${item.branchId}">üîî ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</button>
                <button class="actionBtn bg-purple-600 text-white px-3 py-1 rounded" data-action="sendReminderWithPayment" data-id="${item.idKey}" data-branch-id="${item.branchId}">üîî ‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞</button>
                <button class="actionBtn bg-gray-600 text-white px-3 py-1 rounded" data-action="sendReminderWithoutPayment" data-id="${item.idKey}" data-branch-id="${item.branchId}">üîî ‡∏ü‡∏£‡∏µ</button>
                <button class="actionBtn bg-green-500 text-white px-3 py-1 rounded" data-action="confirmBooking" data-id="${item.idKey}" data-branch-id="${item.branchId}" ${item.status !== '‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô' ? 'disabled style="opacity:.5"' : ''}>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                <button class="actionBtn bg-red-500 text-white px-3 py-1 rounded" data-action="cancelBooking" data-id="${item.idKey}" data-branch-id="${item.branchId}" ${['‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'].includes(item.status) ? 'disabled style="opacity:.5"' : ''}>‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="actionBtn bg-blue-500 text-white px-3 py-1 rounded" data-action="completeBooking" data-id="${item.idKey}" data-branch-id="${item.branchId}" ${['‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å', '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'].includes(item.status) ? 'disabled style="opacity:.5"' : ''}>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>
              </div>
            </td>
          `;
          tbody.appendChild(detailRow);

          // ‡∏ú‡∏π‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏•‡∏±‡∏ö‡πÅ‡∏ñ‡∏ß‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
          row.querySelector('.toggleDetail').onclick = () => {
            detailRow.classList.toggle('hidden');
          };
        });

        // ‡∏ú‡∏π‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° action ‡∏ï‡πà‡∏≤‡∏á‡πÜ
        document.querySelectorAll('.actionBtn').forEach(btn => {
          btn.onclick = () => {
            const action = btn.dataset.action;
            const id = btn.dataset.id;
            const branchId = btn.dataset.branchId;
            confirmAction(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ "${action}" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`, action, id, branchId);
          };
        });
      }

      renderPagination();
    }

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤
    function renderPagination() {
      const container = document.getElementById('pagination');
      container.innerHTML = '';
      const totalPages = Math.ceil(currentData.length / rowsPerPage);
      if (totalPages <= 1) return;

      // ‡∏õ‡∏∏‡πà‡∏° "‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î"
      const btnFirst = document.createElement('button');
      btnFirst.textContent = '‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏∏‡∏î';
      btnFirst.className = 'px-3 py-1 border rounded text-gray-700';
      btnFirst.onclick = () => { currentPage = 1; displayPage(1); };
      btnFirst.disabled = currentPage === 1;
      if (currentPage === 1) btnFirst.classList.add('opacity-50', 'cursor-not-allowed');
      container.appendChild(btnFirst);

      // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ (1 ... totalPages)
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.dataset.page = i;
        btn.className = 'px-3 py-1 border rounded text-gray-700';
        if (i === currentPage) {
          btn.classList.remove('text-gray-700');
          btn.classList.add('bg-indigo-600', 'text-white');
        }
        btn.onclick = () => {
          currentPage = i;
          displayPage(i);
        };
        container.appendChild(btn);
      }

      // ‡∏õ‡∏∏‡πà‡∏° "‡∏´‡∏•‡∏±‡∏á‡∏™‡∏∏‡∏î"
      const btnLast = document.createElement('button');
      btnLast.textContent = '‡∏´‡∏•‡∏±‡∏á‡∏™‡∏∏‡∏î';
      btnLast.className = 'px-3 py-1 border rounded text-gray-700';
      btnLast.onclick = () => { currentPage = totalPages; displayPage(totalPages); };
      btnLast.disabled = currentPage === totalPages;
      if (currentPage === totalPages) btnLast.classList.add('opacity-50', 'cursor-not-allowed');
      container.appendChild(btnLast);
    }
  </script>
</body>

</html>
